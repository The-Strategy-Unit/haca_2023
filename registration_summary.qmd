---
title: "Registration summary"
format:
  html:
    embed-resources: true
execute:
  echo: false
  warning: false
---

## Summary

The following is a RAP(-ish) process to look at the organisations that are currently registered for HACA. It includes some fuzzy string matching because the organisation box was free text.

```{r}

df <- readxl::read_excel("data/Registration Update.xlsx", skip = 1) |> 
  dplyr::filter(!is.na(ID))

name_df <- readxl::read_excel("data/Registration Update.xlsx") |> 
  dplyr::slice(1)

names(df) <- c(names(df)[1:9], names(name_df)[10:15])

names(df) <- gsub("Marketing - ", "", names(df))

patterns <- tolower(c("NHS England", "Trust", "University", 
              "Strategy Unit", "ICB", "Council", "CSU"))

patterns_regex <- paste(patterns, collapse = "|")

df <- df |> 
  dplyr::mutate(
    Organization = tolower(Organization),
    final_org = dplyr::case_when(
      grepl(patterns_regex, Organization, ignore.case = TRUE) ~ 
        stringr::str_extract(Organization, 
                             stringr::regex(patterns_regex, ignore_case = TRUE)),
      TRUE ~ Organization
    ))

```

## Organisation

```{r}

df |> 
  dplyr::count(final_org) |>
  dplyr::arrange(desc(n)) |> 
  dplyr::rename(Organisation = final_org, Number = n) |> 
  DT::datatable()

```

### Note on licence

Crown Copyright, 2023, [MIT licence](https://opensource.org/license/mit/)

